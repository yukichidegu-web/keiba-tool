<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ワイド馬券期待値ツール</title>
<style>
body { font-family: sans-serif; padding: 15px; margin:0; }
h2 { text-align:center; }
button { margin:5px 0; padding:10px; font-size:16px; width:100%; }
input { width: 90%; padding:5px; margin:2px 0; font-size:16px; }
table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; font-size:14px; }
th { background-color: #f0f0f0; }
table { width: 100%; margin-top: 10px; }
.horseRow { border-bottom:1px solid #ccc; padding:5px 0; }
</style>
</head>
<body>

<h2>ワイド馬券期待値ツール</h2>

<button onclick="addHorse()">馬を追加</button>
<button onclick="clearData()">入力データクリア</button>
<button onclick="calculateEV()">EV計算</button>

<div id="horseInputs"></div>

<h3>推奨ワイド買い目（上位3点）</h3>
<table id="resultTable">
<tr><th>馬1</th><th>馬2</th><th>3着内確率</th><th>EV（円）</th></tr>
</table>

<script>
let horses = [];

function addHorse(num='', name='', win='', place='') {
    const index = horses.length;
    horses.push({num, name, win, place, q:0});
    const div = document.createElement('div');
    div.className = 'horseRow';
    div.innerHTML = `
        馬番: <input id="num${index}" value="${num}" type="number" placeholder="馬番"><br>
        馬名: <input id="name${index}" value="${name}" placeholder="馬名"><br>
        単勝: <input id="win${index}" value="${win}" type="number" step="0.1" placeholder="単勝オッズ"><br>
        複勝: <input id="place${index}" value="${place}" type="number" step="0.1" placeholder="複勝オッズ">
    `;
    document.getElementById('horseInputs').appendChild(div);
}

// クリアボタン
function clearData() {
    horses = [];
    document.getElementById('horseInputs').innerHTML = '';
    document.getElementById('resultTable').innerHTML = '<tr><th>馬1</th><th>馬2</th><th>3着内確率</th><th>EV（円）</th></tr>';
}

// EV計算
function calculateEV() {
    const resultTable = document.getElementById('resultTable');
    resultTable.innerHTML = '<tr><th>馬1</th><th>馬2</th><th>3着内確率</th><th>EV（円）</th></tr>';

    // データ取得
    horses.forEach((h,i)=>{
        h.num = document.getElementById(`num${i}`).value;
        h.name = document.getElementById(`name${i}`).value;
        h.win = parseFloat(document.getElementById(`win${i}`).value);
        h.place = parseFloat(document.getElementById(`place${i}`).value);
        h.q = Math.min(1, 1/h.place); // 3着内確率
    });

    const investPerPoint = 200; // 1点200円
    let results = [];

    // 全組み合わせのEV計算
    for(let i=0;i<horses.length;i++){
        for(let j=i+1;j<horses.length;j++){
            const h1 = horses[i], h2 = horses[j];
            const prob = h1.q * h2.q;
            const payout = investPerPoint*2; // 仮2倍
            const ev = prob * payout - investPerPoint;
            if(ev > 0){
                results.push({h1:h1.num+'-'+h1.name, h2:h2.num+'-'+h2.name, prob, ev});
            }
        }
    }

    // 上位3点抽出
    results.sort((a,b)=>b.ev - a.ev);
    results.slice(0,3).forEach(r=>{
        const row = resultTable.insertRow();
        row.insertCell(0).innerText = r.h1;
        row.insertCell(1).innerText = r.h2;
        row.insertCell(2).innerText = (r.prob*100).toFixed(1)+'%';
        row.insertCell(3).innerText = r.ev.toFixed(0);
    });
}
</script>

</body>
</html>