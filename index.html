<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ワイド自動変換ツール</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f5f5f5;
    padding: 12px;
  }
  h2 {
    font-size: 18px;
    margin-top: 20px;
  }
  textarea {
    width: 100%;
    height: 120px;
    font-size: 14px;
    padding: 10px;
    box-sizing: border-box;
  }
  button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    margin-top: 10px;
  }
  pre {
    background: #fff;
    padding: 10px;
    font-size: 14px;
    white-space: pre-wrap;
    margin-top: 6px;
  }
  .ng {
    color: red;
    font-weight: bold;
  }
</style>
</head>

<body>

<h2>① 馬データ貼り付け</h2>
<textarea id="horseInput"></textarea>

<h2>② ワイドデータ貼り付け</h2>
<textarea id="wideInput"></textarea>

<button onclick="processAll()">変換する</button>
<button onclick="clearAll()">クリア</button>

<h2>③ 馬データ（変換後）</h2>
<pre id="horseOutput"></pre>

<h2>④ ワイドデータ（変換後）</h2>
<pre id="wideOutput"></pre>

<h2>⑤ ワイド判定（4.5倍基準）</h2>
<pre id="judgeOutput"></pre>

<script>
function normalizeHorseText(raw) {
  const lines = raw.split("\n").map(l => l.trim()).filter(l =>
    l && !l.includes("人気") && !l.includes("複勝")
  );

  let result = [];
  let temp = {};

  lines.forEach(line => {
    if (/^\d+$/.test(line)) temp.num = line;
    else if (/^\d+\.\d+$/.test(line)) temp.odd = line;
    else temp.name = line;

    if (temp.num && temp.name && temp.odd) {
      result.push(`${temp.num} ${temp.name} ${temp.odd}`);
      temp = {};
    }
  });

  return result;
}

function normalizeWideText(raw) {
  const lines = raw.split("\n").map(l => l.trim()).filter(l =>
    l && !["人気", "組番", "オッズ", "-"].includes(l)
  );

  let result = [];
  let temp = null;

  lines.forEach(line => {
    if (/^\d+-\d+$/.test(line)) {
      temp = line;
    } else if (/^\d+\.\d+$/.test(line) && temp) {
      result.push(`${temp} ${line}`);
      temp = null;
    }
  });

  return result;
}

function processAll() {
  const horseRaw = document.getElementById("horseInput").value;
  const wideRaw = document.getElementById("wideInput").value;

  const horses = normalizeHorseText(horseRaw);
  const wides = normalizeWideText(wideRaw);

  document.getElementById("horseOutput").textContent =
    horses.join("\n");

  document.getElementById("wideOutput").textContent =
    wides.join("\n");

  let judge = "";
  wides.forEach(w => {
    const [pair, odd] = w.split(" ");
    if (parseFloat(odd) < 4.5) {
      judge += `❌ ${pair} ${odd}\n`;
    } else {
      judge += `⭕ ${pair} ${odd}\n`;
    }
  });

  document.getElementById("judgeOutput").textContent = judge;
}

function clearAll() {
  document.getElementById("horseInput").value = "";
  document.getElementById("wideInput").value = "";
  document.getElementById("horseOutput").textContent = "";
  document.getElementById("wideOutput").textContent = "";
  document.getElementById("judgeOutput").textContent = "";
}
</script>

</body>
</html>