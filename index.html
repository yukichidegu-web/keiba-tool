<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ワイド3点 自動判定ツール</title>
<style>
body { font-family: sans-serif; padding: 10px; }
textarea { width: 100%; height: 140px; margin-bottom: 10px; }
button { padding: 10px; width: 100%; font-size: 16px; }
.result { margin-top: 15px; white-space: pre-wrap; }
.good { color: red; font-weight: bold; }
</style>
</head>
<body>

<h3>① 単勝＋複勝データ</h3>
<textarea id="odds"></textarea>

<h3>② ワイドデータ</h3>
<textarea id="wide"></textarea>

<button onclick="calculate()">スコア計算 ＆ 買い目表示</button>

<div class="result" id="result"></div>

<script>
function calculate() {
  const oddsText = document.getElementById("odds").value;
  const wideText = document.getElementById("wide").value;

  let horses = {};
  const lines = oddsText.split("\n");

  for (let i = 0; i < lines.length; i++) {
    const m = lines[i].match(/^(\d+)\s+(\d+)\s+.+\s+([\d.]+)\s+([\d.]+)/);
    if (m) {
      const num = m[2];
      const win = parseFloat(m[3]);
      const placeLow = parseFloat(m[4]);
      horses[num] = {
        win,
        placeLow,
        score: 0,
        wideCount: 0
      };
    }
  }

  // 単勝断層
  const sorted = Object.entries(horses).sort((a,b)=>a[1].win-b[1].win);
  if (sorted[2] && sorted[2][1].win >= sorted[1][1].win * 1.8) {
    sorted[0][1].score += 40;
    sorted[1][1].score += 38;
  }

  // 複勝下限
  for (let h in horses) {
    if (horses[h].placeLow <= 1.3) horses[h].score += 30;
    else if (horses[h].placeLow <= 1.6) horses[h].score += 22;
    else if (horses[h].placeLow <= 2.1) horses[h].score += 18;
  }

  // 人気補正
  sorted.forEach((e,i)=>{
    if (i<=1) e[1].score += 10;
    else if (i<=3) e[1].score += 7;
  });

  // ワイド支持
  wideText.split("\n").forEach(l=>{
    const m = l.match(/(\d+)-(\d+)/);
    if (m) {
      if (horses[m[1]]) horses[m[1]].wideCount++;
      if (horses[m[2]]) horses[m[2]].wideCount++;
    }
  });

  for (let h in horses) {
    horses[h].score += horses[h].wideCount * 3;
  }

  // 結果表示
  let result = "【スコア一覧】\n";
  let entries = Object.entries(horses).sort((a,b)=>b[1].score-a[1].score);
  entries.forEach(e=>{
    result += `馬番${e[0]}：${e[1].score}点\n`;
  });

  const axis = entries.find(e=>e[1].score>=80);
  if (!axis) {
    document.getElementById("result").innerText = result + "\n→ 見送り";
    return;
  }

  const axisNum = axis[0];
  const partners = entries
    .filter(e=>e[0]!==axisNum)
    .sort((a,b)=>b[1].wideCount-a[1].wideCount)
    .slice(0,3);

  result += `\n◎ 軸：${axisNum}\n\n【最適ワイド3点】\n`;
  partners.forEach(p=>{
    result += `${axisNum}-${p[0]}\n`;
  });
  result += "\n各500円 / 計1500円";

  document.getElementById("result").innerText = result;
}
</script>

</body>
</html>