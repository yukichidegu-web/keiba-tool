<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ワイド期待収益シミュレーション（1か月版）</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
textarea,input,button { width: 100%; margin-bottom: 10px; }
button { padding: 8px 16px; }
.result { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h2>ワイド期待収益シミュレーション（1か月版）</h2>

<h3>ワイドデータ貼り付け</h3>
<textarea id="wideData" rows="10" placeholder="組番	オッズ下限-上限&#10例: 8-10	6.2-7.0"></textarea>

<h3>設定</h3>
<label>1レース購入金額（円）: <input type="number" id="raceMoney" value="1500"></label>
<label>最大購入点数: <input type="number" id="maxPoints" value="3"></label>
<label>稼働日数/月: <input type="number" id="daysPerMonth" value="8"></label>
<label>1日あたりレース数: <input type="number" id="racesPerDay" value="8"></label>
<label>1レース目標期待収益（円）: <input type="number" id="targetEV" value="470"></label>

<button onclick="simulateMonth()">1か月シミュレーション</button>

<div class="result" id="result"></div>

<script>
function simulateMonth() {
    const wideText = document.getElementById("wideData").value.trim();
    const raceMoney = parseFloat(document.getElementById("raceMoney").value);
    const maxPoints = parseInt(document.getElementById("maxPoints").value);
    const daysPerMonth = parseInt(document.getElementById("daysPerMonth").value);
    const racesPerDay = parseInt(document.getElementById("racesPerDay").value);
    const targetEV = parseFloat(document.getElementById("targetEV").value);

    if(!wideText) {
        alert("ワイドデータを入力してください");
        return;
    }

    // ワイドデータを配列化
    const wideLines = wideText.split("\n").map(l => l.trim()).filter(l => l);
    let widePairs = wideLines.map(l => {
        const parts = l.split(/\t| /);
        const pair = parts[0].split("-");
        const odds = parts[1].split("-").map(n => parseFloat(n));
        return {pair, odds};
    });

    // 自動調整：下限オッズを徐々に上げて目標EVに近づける
    let minOdds = 0.1;
    let selectedPairs = [];
    let evPerRace = 0;
    let amounts = [];
    while(minOdds <= 20) {
        selectedPairs = widePairs.filter(w => w.odds[0] >= minOdds).slice(0, maxPoints);
        if(selectedPairs.length === 0) { minOdds += 0.1; continue; }

        // 購入金額配分（均等）
        amounts = selectedPairs.map(_ => Math.round(raceMoney/maxPoints));

        // 期待収益計算
        evPerRace = 0;
        selectedPairs.forEach((w,i)=>{
            const avgOdds = (w.odds[0]+w.odds[1])/2;
            evPerRace += amounts[i]*(avgOdds-1);
        });

        if(evPerRace >= targetEV) break;
        minOdds += 0.1;
    }

    const dailyEV = evPerRace * racesPerDay;
    const monthlyEV = dailyEV * daysPerMonth;
    const monthlyInvestment = raceMoney * racesPerDay * daysPerMonth;

    // 結果表示
    let html = "<h3>1か月シミュレーション結果</h3>";
    html += `<p>1レース期待収益: ${evPerRace.toFixed(0)}円</p>`;
    html += `<p>下限オッズ: ${minOdds.toFixed(1)}</p>`;
    html += `<p>1日期待収益: ${dailyEV.toFixed(0)}円</p>`;
    html += `<p>月間期待収益: ${monthlyEV.toFixed(0)}円</p>`;
    html += `<p>月間投資額: ${monthlyInvestment.toFixed(0)}円</p>`;
    html += `<p>期待値割合（EV%）: ${(monthlyEV/monthlyInvestment*100).toFixed(1)}%</p>`;

    html += "<h4>購入ワイド組み合わせ（1レースあたり）</h4><ul>";
    selectedPairs.forEach((w,i)=>{
        const avgOdds = ((w.odds[0]+w.odds[1])/2).toFixed(2);
        html += `<li>${w.pair.join("-")} （平均オッズ: ${avgOdds}、購入額: ${amounts[i]}円）</li>`;
    });
    html += "</ul>";

    document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>