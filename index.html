<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ä¸­å¤®ç«¶é¦¬ è‡ªå‹•ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ç«¶é¦¬ã‚¹ã‚³ã‚¢">

<style>
body { font-family:sans-serif; background:#fafafa; padding:10px; }
textarea { width:100%; height:120px; margin-bottom:6px; }
button { width:100%; padding:14px; font-size:18px; margin-bottom:6px; border-radius:10px; }
.race { padding:10px; margin-bottom:10px; border-radius:8px; font-weight:bold; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.a-axis { background:#ffdddd; border-left:6px solid #e60000; }
.b-axis { background:#fff0cc; border-left:6px solid #ff9900; }
.skip   { background:#f0f0f0; color:#999; }
.wide { background:#ddf0ff; border-left:6px solid #3399ff; padding:8px; margin-bottom:8px; border-radius:6px; font-weight:bold; }
</style>
</head>
<body>

<h3>â‘  å˜å‹ãƒ»è¤‡å‹ãƒ‡ãƒ¼ã‚¿è²¼ã‚Šä»˜ã‘</h3>
<textarea id="odds" placeholder="netkeibaå½¢å¼ã®è¤‡æ•°è¡Œè²¼ã‚Šä»˜ã‘"></textarea>

<h3>â‘¡ ãƒ¯ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿è²¼ã‚Šä»˜ã‘ï¼ˆä»»æ„ï¼‰</h3>
<textarea id="wide" placeholder="netkeibaå½¢å¼ã®è¤‡æ•°è¡Œè²¼ã‚Šä»˜ã‘"></textarea>

<button onclick="calculate()">ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ»è²·ã„ç›®è¡¨ç¤º</button>
<button onclick="clearAll()">ã‚¯ãƒªã‚¢</button>

<h3>çµæœ</h3>
<div id="result"></div>

<hr>
<h3>çš„ä¸­ç®¡ç†</h3>
<input type="number" id="hit" placeholder="æ‰•æˆ»é¡å…¥åŠ›">
<button onclick="record()">ğŸ¯ çš„ä¸­è¨˜éŒ²</button>
<button onclick="summary()">ğŸ“Š ä»Šæœˆã®æˆç¸¾</button>

<script>
function clearAll(){
  odds.value=""; wide.value=""; result.innerHTML="";
}

// --- å˜å‹ãƒ»è¤‡å‹è¤‡æ•°è¡Œå¯¾å¿œ ---
function parseOdds(text){
  const lines = text.split("\n");
  let horses=[], buffer=[];
  lines.forEach(l=>{
    l=l.trim();
    if(!l) return;
    if(!isNaN(l) && buffer.length===0){ buffer.push(l); return; } // äººæ°—
    if(!isNaN(l) && buffer.length===1){ buffer.push(l); return; } // é¦¬ç•ª
    if(isNaN(l) && buffer.length===2){ buffer.push(l); return; } // é¦¬å
    if(!isNaN(l) && buffer.length===3){ buffer.push(l); return; } // å˜å‹
    if(!isNaN(l) && buffer.length===4){ buffer.push(l); }         // è¤‡å‹
    if(buffer.length===5){
      horses.push({
        num: buffer[1],
        name: buffer[2],
        win: parseFloat(buffer[3]),
        place: parseFloat(buffer[4]),
        score:0,
        pop:0
      });
      buffer=[];
    }
  });
  return horses;
}

// --- ãƒ¯ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿è§£æ ---
function parseWide(text){
  const lines=text.split("\n");
  let wideArr=[];
  let buffer=[];
  lines.forEach(l=>{
    l=l.trim();
    if(!l) return;
    if(!isNaN(l) && buffer.length===0){ buffer.push(l); return; } // äººæ°—
    if(buffer.length===1 && l.includes("-")){ buffer.push(l); return; } // çµ„ç•ª
    if(!isNaN(l)){ buffer.push(l); } // ã‚ªãƒƒã‚ºæœ€ä½
    if(buffer.length===3){
      wideArr.push({combo:buffer[1], odds:parseFloat(buffer[2])});
      buffer=[];
    }
  });
  return wideArr;
}

// --- ã‚¹ã‚³ã‚¢è¨ˆç®— ---
function calculate(){
  let horses=parseOdds(odds.value);
  if(horses.length===0){ result.innerHTML="ãƒ‡ãƒ¼ã‚¿ã‚’èªè­˜ã§ãã¾ã›ã‚“"; return; }

  horses.sort((a,b)=>a.win-b.win);
  horses.forEach((h,i)=>h.pop=i+1);

  // å˜å‹æ–­å±¤åŠ ç‚¹
  if(horses[2] && horses[2].win >= horses[1].win*1.8){
    horses[0].score+=40;
    horses[1].score+=38;
  }

  horses.forEach(h=>{
    if(h.place<=1.3) h.score+=30;
    else if(h.place<=1.6) h.score+=22;
    else if(h.place<=2.1) h.score+=18;
    const bal=h.win*h.place;
    if(bal<=4.5) h.score+=15;
    else if(bal<=6.0) h.score+=10;
    if(h.pop<=2) h.score+=10;
    else if(h.pop<=4) h.score+=7;
  });

  horses.sort((a,b)=>b.score-a.score);

  // --- çµæœå‡ºåŠ› ---
  let html="";
  horses.forEach(h=>{
    let cls="skip", txt="SKIP";
    if(h.score>=85){ cls="a-axis"; txt="Aè»¸ï½œãƒ¯ã‚¤ãƒ‰3ç‚¹ 1500å††"; }
    else if(h.score>=78 && h.score<=84 && h.win>=2.8 && h.win<=7.5 && h.place>=1.4 && h.pop!==1){ cls="b-axis"; txt="Bè»¸ï½œãƒ¯ã‚¤ãƒ‰2ç‚¹ 1000å††"; }
    html+=`<div class="race ${cls}">é¦¬ç•ª${h.num}ï½œ${h.name}ï½œã‚¹ã‚³ã‚¢${h.score}<br><small>${txt}</small></div>`;
  });

  // --- ãƒ¯ã‚¤ãƒ‰è¡¨ç¤º ---
  let wideArr=parseWide(wide.value);
  if(wideArr.length>0){
    html+="<h4>ãƒ¯ã‚¤ãƒ‰è²·ã„ç›®</h4>";
    wideArr.forEach(w=>{
      html+=`<div class="wide">${w.combo}ï½œã‚ªãƒƒã‚º${w.odds}</div>`;
    });
  }

  result.innerHTML=html;
}

// --- çš„ä¸­ç®¡ç† ---
function record(){
  const p=+hit.value;
  if(!p) return alert("æ‰•æˆ»é¡ã‚’å…¥åŠ›");
  const logs=JSON.parse(localStorage.getItem("log")||"[]");
  logs.push({d:new Date().toISOString().slice(0,10), p});
  localStorage.setItem("log",JSON.stringify(logs));
  hit.value="";
  alert("è¨˜éŒ²ã—ã¾ã—ãŸ");
}

function summary(){
  const logs=JSON.parse(localStorage.getItem("log")||"[]");
  const m=new Date().toISOString().slice(0,7);
  const t=logs.filter(l=>l.d.startsWith(m));
  const pay=t.reduce((s,l)=>s+l.p,0);
  alert(`ä»Šæœˆ\nå›æ•°:${t.length}\nå›å:${pay.toLocaleString()}å††`);
}

</script>
</body>
</html>