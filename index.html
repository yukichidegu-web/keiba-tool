<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>中央競馬 ワイド買い目ツール（確率付）</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="競馬ワイド確率">
<style>
body { font-family:sans-serif; background:#fafafa; padding:10px; }
textarea { width:100%; height:120px; margin-bottom:6px; font-size:16px; }
button { width:100%; padding:12px; font-size:16px; margin-bottom:6px; border-radius:8px; }
.wide { background:#ddf0ff; border-left:6px solid #3399ff; padding:8px; margin-bottom:6px; border-radius:6px; font-weight:bold; }
</style>
</head>
<body>

<h3>① 単勝・複勝データ貼り付け</h3>
<textarea id="odds" placeholder="人気/馬番/馬名/単勝/複勝(最後の値)を複数行"></textarea>

<h3>② ワイドデータ貼り付け</h3>
<textarea id="wide" placeholder="人気/組番/下限オッズを複数行"></textarea>

<button onclick="calculate()">買い目表示（確率付き）</button>
<button onclick="clearAll()">クリア</button>

<h3>結果</h3>
<div id="result"></div>

<script>
function clearAll(){ odds.value=""; wide.value=""; result.innerHTML=""; }

// --- 単勝・複勝解析 ---
function parseOdds(text){
  const lines=text.split("\n").map(l=>l.trim()).filter(l=>l!=="");
  let horses=[], buffer=[];
  lines.forEach(l=>{
    if(!isNaN(l)){ buffer.push(parseFloat(l)); }
    else { buffer.push(l); }
    if(buffer.length===5){
      horses.push({
        num: buffer[1],
        name: buffer[2],
        win: parseFloat(buffer[3]),
        place: parseFloat(buffer[4])
      });
      buffer=[];
    }
  });
  return horses;
}

// --- ワイド解析 ---
function parseWide(text){
  const lines=text.split("\n").map(l=>l.trim()).filter(l=>l!=="");
  let wideArr=[], buffer=[];
  lines.forEach(l=>{
    if(!isNaN(l)){ buffer.push(parseFloat(l)); }
    else if(l.includes("-")){ buffer.push(l); }
    if(buffer.length===3){
      wideArr.push({combo:buffer[1], odds:buffer[0]});
      buffer=[];
    }
  });
  return wideArr;
}

// --- 当たる確率計算 ---
function calcProb(horses, nums){
  // 簡易モデル：複勝下限値で3着以内率
  let p1 = horses.find(h=>h.num==nums[0]).place;
  let p2 = horses.find(h=>h.num==nums[1]).place;
  let prob = (1/p1) * (1/p2); // 仮の掛け算モデル
  if(prob>0.9) prob=0.9;
  return prob;
}

// --- 推奨買い目 ---
function selectWide(horses, wideArr){
  horses.sort((a,b)=>a.win - b.win);
  const aAxis=horses.slice(0,3).map(h=>h.num); // A軸
  const bAxis=horses.slice(3,5).map(h=>h.num); // B軸

  let aList=[], bList=[];
  wideArr.forEach(w=>{
    const nums=w.combo.split("-").map(x=>x.trim());
    let prob = calcProb(horses, nums);
    if(aAxis.includes(nums[0]) || aAxis.includes(nums[1])) aList.push({...w, prob});
    else if(bAxis.includes(nums[0]) || bAxis.includes(nums[1])) bList.push({...w, prob});
  });

  return {aList:aList.slice(0,3), bList:bList.slice(0,2)};
}

// --- メイン ---
function calculate(){
  let horses=parseOdds(odds.value);
  if(horses.length===0){ result.innerHTML="データがありません"; return; }

  let wideArr=parseWide(wide.value);
  const wideSelected = selectWide(horses, wideArr);

  let html="<h4>A軸 3点（メイン）</h4>";
  wideSelected.aList.forEach(w=>{
    html+=`<div class="wide">${w.combo}｜下限オッズ:${w.odds}｜当たる確率:${(w.prob*100).toFixed(0)}%</div>`;
  });

  html+="<h4>B軸 2点（穴狙い）</h4>";
  wideSelected.bList.forEach(w=>{
    html+=`<div class="wide">${w.combo}｜下限オッズ:${w.odds}｜当たる確率:${(w.prob*100).toFixed(0)}%</div>`;
  });

  result.innerHTML=html;
}
</script>
</body>
</html>