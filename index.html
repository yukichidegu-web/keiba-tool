<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ä¸­å¤®ç«¶é¦¬ è‡ªå‹•ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ç«¶é¦¬ã‚¹ã‚³ã‚¢">
<style>
body { font-family:sans-serif; background:#fafafa; padding:10px; }
textarea { width:100%; height:120px; margin-bottom:6px; font-size:16px; }
button { width:100%; padding:14px; font-size:18px; margin-bottom:6px; border-radius:10px; }
.race {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:6px 10px;
  margin-bottom:6px;
  border-radius:8px;
  font-weight:bold;
  box-shadow:0 2px 4px rgba(0,0,0,0.1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.race small { font-weight: normal; font-size: 0.85em; margin-left:6px; }
.a-axis { background:#ffdddd; border-left:6px solid #e60000; }
.b-axis { background:#fff0cc; border-left:6px solid #ff9900; }
.skip { background:#f0f0f0; color:#999; }
.wide {
  display:flex;
  justify-content:space-between;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
  background:#ddf0ff;
  border-left:6px solid #3399ff;
  padding:6px 10px;
  margin-bottom:6px;
  border-radius:6px;
  font-weight:bold;
}
</style>
</head>
<body>

<h3>â‘  å˜å‹ãƒ»è¤‡å‹ãƒ‡ãƒ¼ã‚¿è²¼ã‚Šä»˜ã‘</h3>
<textarea id="odds" placeholder="äººæ°—åˆ—å«ã‚€netkeibaå½¢å¼ã®è¤‡æ•°è¡Œè²¼ã‚Šä»˜ã‘"></textarea>

<h3>â‘¡ ãƒ¯ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿è²¼ã‚Šä»˜ã‘ï¼ˆä»»æ„ï¼‰</h3>
<textarea id="wide" placeholder="äººæ°—åˆ—å«ã‚€netkeibaå½¢å¼ã®è¤‡æ•°è¡Œè²¼ã‚Šä»˜ã‘"></textarea>

<button onclick="calculate()">ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ»è²·ã„ç›®è¡¨ç¤º</button>
<button onclick="clearAll()">ã‚¯ãƒªã‚¢</button>

<h3>çµæœ</h3>
<div id="result"></div>

<hr>
<h3>çš„ä¸­ç®¡ç†</h3>
<input type="number" id="hit" placeholder="æ‰•æˆ»é¡å…¥åŠ›">
<button onclick="record()">ğŸ¯ çš„ä¸­è¨˜éŒ²</button>
<button onclick="summary()">ğŸ“Š ä»Šæœˆã®æˆç¸¾</button>

<script>
// ã‚¯ãƒªã‚¢
function clearAll(){ odds.value=""; wide.value=""; result.innerHTML=""; }

// --- å˜å‹ãƒ»è¤‡å‹è§£æï¼ˆäººæ°—åˆ—å¯¾å¿œã€è¤‡å‹æœ€å¾Œã®æ•°å€¤ã‚’ä½¿ç”¨ï¼‰ ---
function parseOdds(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(l=>l!=="");
  let horses=[], buffer=[];
  lines.forEach(l=>{
    if(["äººæ°—","é¦¬ç•ª","é¦¬å","å˜å‹","è¤‡å‹(3ç€æ‰•ã„)"].includes(l)) return; // ãƒ˜ãƒƒãƒ€ç„¡è¦–
    if(l === "-") return; // è¤‡å‹ã®"-"ç„¡è¦–
    buffer.push(l);
    if(buffer.length===6){ // äººæ°—, é¦¬ç•ª, é¦¬å, å˜å‹, è¤‡å‹(é€”ä¸­), è¤‡å‹(æœ€å¾Œ)
      horses.push({
        num: buffer[1],
        name: buffer[2],
        win: parseFloat(buffer[3]),
        place: parseFloat(buffer[5]),
        score:0,
        pop:parseInt(buffer[0])
      });
      buffer=[];
    }
  });
  return horses;
}

// --- ãƒ¯ã‚¤ãƒ‰è§£æï¼ˆäººæ°—åˆ—å¯¾å¿œã€ä¸‹é™ä½¿ç”¨ï¼‰ ---
function parseWide(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(l=>l!=="");
  let wideArr=[], buffer=[];
  lines.forEach(l=>{
    if(["äººæ°—","çµ„ç•ª","ã‚ªãƒƒã‚º"].includes(l)) return; // ãƒ˜ãƒƒãƒ€ç„¡è¦–
    if(l === "-") return;
    buffer.push(l);
    if(buffer.length===3){ // äººæ°—, çµ„ç•ª, ä¸‹é™ã‚ªãƒƒã‚º
      wideArr.push({combo: buffer[1], odds: parseFloat(buffer[2])});
      buffer=[];
    }
  });
  return wideArr;
}

// --- æ¨å¥¨ãƒ¯ã‚¤ãƒ‰3ç‚¹æŠ½å‡º ---
function selectTopWide(horses, wideArr){
  let selected=[];
  const axes=horses.filter(h=>h.score>=78).map(h=>h.num.toString());
  wideArr.forEach(w=>{
    let nums=w.combo.split("-").map(x=>x.trim());
    if(axes.includes(nums[0]) || axes.includes(nums[1])) selected.push(w);
  });
  selected = selected.filter(w=>w.odds>=1.5 && w.odds<=15);
  return selected.slice(0,3);
}

// --- ã‚¹ã‚³ã‚¢è¨ˆç®— ---
function calculate(){
  let horses=parseOdds(odds.value);
  if(horses.length===0){ result.innerHTML="ãƒ‡ãƒ¼ã‚¿ã‚’èªè­˜ã§ãã¾ã›ã‚“"; return; }

  horses.sort((a,b)=>a.win-b.win);
  horses.forEach((h,i)=>h.pop=i+1);

  // å˜å‹æ–­å±¤åŠ ç‚¹
  if(horses[2] && horses[2].win >= horses[1].win*1.8){
    horses[0].score+=40;
    horses[1].score+=38;
  }

  horses.forEach(h=>{
    if(h.place<=1.3) h.score+=30;
    else if(h.place<=1.6) h.score+=22;
    else if(h.place<=2.1) h.score+=18;
    const bal=h.win*h.place;
    if(bal<=4.5) h.score+=15;
    else if(bal<=6.0) h.score+=10;
    if(h.pop<=2) h.score+=10;
    else if(h.pop<=4) h.score+=7;
  });

  horses.sort((a,b)=>b.score-a.score);

  let html="";
  horses.forEach(h=>{
    let cls="skip", txt="SKIP";
    if(h.score>=85){ cls="a-axis"; txt="Aè»¸ï½œãƒ¯ã‚¤ãƒ‰3ç‚¹ 1500å††"; }
    else if(h.score>=78 && h.score<=84 && h.win>=2.8 && h.win<=7.5 && h.place>=1.4 && h.pop!==1){ cls="b-axis"; txt="Bè»¸ï½œãƒ¯ã‚¤ãƒ‰2ç‚¹ 1000å††"; }
    html+=`<div class="race ${cls}">é¦¬ç•ª${h.num}ï½œ${h.name}ï½œã‚¹ã‚³ã‚¢${h.score}<br><small>${txt}</small></div>`;
  });

  let wideArr=parseWide(wide.value);
  if(wideArr.length>0){
    const topWide = selectTopWide(horses, wideArr);
    html+="<h4>æ¨å¥¨ãƒ¯ã‚¤ãƒ‰3ç‚¹ï¼ˆä¸‹é™ã‚ªãƒƒã‚ºä½¿ç”¨ï¼‰</h4>";
    topWide.forEach(w=>{
      html+=`<div class="wide">${w.combo}ï½œã‚ªãƒƒã‚º${w.odds}</div>`;
    });
  }

  result.innerHTML=html;
}

// --- çš„ä¸­ç®¡ç† ---
function record(){
  const p=+hit.value;
  if(!p) return alert("æ‰•æˆ»é¡ã‚’å…¥åŠ›");
  const logs=JSON.parse(localStorage.getItem("log")||"[]");
  logs.push({d:new Date().toISOString().slice(0,10), p});
  localStorage.setItem("log",JSON.stringify(logs));
  hit.value="";
  alert("è¨˜éŒ²ã—ã¾ã—ãŸ");
}

function summary(){
  const logs=JSON.parse(localStorage.getItem("log")||"[]");
  const m=new Date().toISOString().slice(0,7);
  const t=logs.filter(l=>l.d.startsWith(m));
  const pay=t.reduce((s,l)=>s+l.p,0);
  alert(`ä»Šæœˆ\nå›æ•°:${t.length}\nå›å:${pay.toLocaleString()}å††`);
}
</script>
</body>
</html>