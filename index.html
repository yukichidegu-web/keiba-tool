<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ワイド馬券3点 自動最適化ツール</title>
<style>
body { font-family: -apple-system, sans-serif; margin: 15px; background:#f5f5f5; }
h2 { text-align:center; }
textarea { width: 100%; padding: 10px; font-size:16px; }
button { width: 100%; padding: 15px; font-size:18px; border:none; border-radius:8px; margin:10px 0; }
.generate-btn { background:#007AFF; color:white; }
.clear-btn { background:#FF3B30; color:white; }
.result-card { background:white; padding:15px; border-radius:10px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
.result-card h3 { margin:0 0 5px 0; }
</style>
</head>
<body>
<h2>ワイド馬券3点 自動最適化ツール</h2>

<p>馬番と単勝オッズを入力（カンマ区切り）</p>
<textarea id="oddsInput" rows="3" placeholder="例: 1,2.0,2,2.1,3,4.5,4,4.7,5,9.0"></textarea>

<label>1レース予算: <span id="budgetLabel">1500</span>円</label>
<input type="range" id="budgetRange" min="500" max="5000" step="100" value="1500" oninput="document.getElementById('budgetLabel').innerText=this.value">

<button class="generate-btn" onclick="calculate()">買い目生成</button>
<button class="clear-btn" onclick="clearData()">データクリア</button>

<h3>結果</h3>
<div id="result"></div>

<script>
function calculate(){
    const input = document.getElementById("oddsInput").value.trim();
    if(!input){ alert("入力してください"); return; }
    const budget = parseInt(document.getElementById("budgetRange").value);
    const data = input.split(',').map(s=>s.trim());

    let horses = [];
    for(let i=0;i<data.length;i+=2){
        horses.push({num:data[i], odds:parseFloat(data[i+1])});
    }

    // 単勝オッズ昇順
    horses.sort((a,b)=>a.odds-b.odds);

    // 断層判定
    let maxDiff = 0, breakIndex = 0;
    for(let i=0;i<horses.length-1;i++){
        let diff = horses[i+1].odds - horses[i].odds;
        if(diff>maxDiff){ maxDiff = diff; breakIndex=i; }
    }

    // 軸馬 = 断層手前の人気上位
    let axisCandidates = horses.slice(0, breakIndex+1);
    let axis = axisCandidates[0];

    // 流す相手 = 断層後の人気馬から2頭
    let flowCandidates = horses.slice(breakIndex+1, breakIndex+3);
    if(flowCandidates.length<2){
        for(let h of horses){
            if(!flowCandidates.includes(h) && h.num!==axis.num && flowCandidates.length<2){
                flowCandidates.push(h);
            }
        }
    }

    // 人気別的中率補正（仮定値）
    function hitProb(odds){
        if(odds<=2.5) return 0.45;
        if(odds<=5) return 0.30;
        if(odds<=8) return 0.20;
        return 0.12;
    }

    // 各買い目の期待値計算
    let bets = flowCandidates.map(t=>{
        let prob = hitProb(t.odds);
        let expected = prob * t.odds;
        return {num:t.num, odds:t.odds, prob:prob, expected:expected};
    });

    // 投資額配分 = 期待値比率に応じて自動調整
    let totalExpected = bets.reduce((sum,b)=>sum+b.expected,0);
    bets.forEach(b=>{ b.invest = Math.floor(b.expected / totalExpected * budget); });

    // 結果表示
    let resultHTML = `<div class="result-card"><h3>軸馬: ${axis.num}</h3><ul>`;
    bets.forEach(b=>{
        resultHTML += `<li>${axis.num}-${b.num} 投資額: ${b.invest}円 (期待値: ${(b.expected*b.invest).toFixed(0)}円)</li>`;
    });
    resultHTML += `</ul>`;
    let totalEV = bets.reduce((sum,b)=>sum+b.expected*b.invest,0);
    resultHTML += `<p>合計期待値: ${totalEV.toFixed(0)}円</p></div>`;

    document.getElementById("result").innerHTML = resultHTML;
}

function clearData(){
    document.getElementById("oddsInput").value = '';
    document.getElementById("result").innerHTML = '';
}
</script>
</body>
</html>