<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>中央競馬 ワイド買い目 A/B軸 確率付き</title>
<style>
  body{font-family:sans-serif;margin:20px;}
  textarea{width:100%;height:150px;margin-bottom:10px;}
  button{margin:5px;}
  table, th, td{border:1px solid #333;border-collapse:collapse;padding:5px;text-align:center;}
  th{background:#eee;}
</style>
</head>
<body>
<h2>馬データ（馬番,馬名,単勝,複勝最後の数値,スコア）</h2>
<textarea id="horseData" placeholder="例: 13,バタール,1.6,1.2,90"></textarea>

<h2>ワイド下限オッズデータ（組番,下限オッズ）</h2>
<textarea id="wideData" placeholder="例: 13-26,3.8"></textarea>

<button onclick="process()">買い目算出</button>
<button onclick="clearData()">クリア</button>

<h2>推奨ワイド買い目（合計5点、確率付き）</h2>
<div id="result"></div>

<script>
function clearData(){
  document.getElementById('horseData').value='';
  document.getElementById('wideData').value='';
  document.getElementById('result').innerHTML='';
}

function process(){
  const horseLines = document.getElementById('horseData').value.trim().split('\n').filter(l=>l);
  const wideLines = document.getElementById('wideData').value.trim().split('\n').filter(l=>l);

  // 馬データ整形（馬番は文字列固定）
  let horses = [];
  for(let line of horseLines){
    let parts = line.split(/\s*,\s*|\s+/).filter(s=>s);
    if(parts.length>=5){
      horses.push({
        num: parts[0].toString(),
        name: parts[1],
        win: parseFloat(parts[2]),
        place: parseFloat(parts[3]),
        score: parseFloat(parts[4])
      });
    }
  }

  // 下限オッズ整形
  let wide = {};
  for(let line of wideLines){
    let parts = line.replace(/\s+/g,'').split(/,|\s+/);
    if(parts.length>=2){
      wide[parts[0]] = parseFloat(parts[1]);
    }
  }

  // A軸3頭（スコア順）
  horses.sort((a,b)=>b.score-a.score);
  const axesA = horses.slice(0,3);

  // B軸2頭（残りスコア順または穴馬優先）
  const remaining = horses.slice(); // A軸と被ってOK
  const axesB = remaining.sort((a,b)=>b.score-a.score).slice(0,2);

  const aAmount = 1500/3; // 500円
  const bAmount = 1000/2; // 500円

  // A軸組み合わせ（3頭 → 3点）
  let aComb = [];
  for(let i=0;i<axesA.length;i++){
    for(let j=i+1;j<axesA.length;j++){
      let key = `${axesA[i].num}-${axesA[j].num}`;
      if(wide[key]){
        aComb.push({
          combo: key,
          odds: wide[key],
          amount: aAmount,
          prob: (1 / wide[key]).toFixed(2)
        });
      }
    }
  }

  // B軸組み合わせ（2頭 → 2点）
  let bComb = [];
  if(axesB.length>=2){
    let pairs = [
      `${axesB[0].num}-${axesB[1].num}`,
      `${axesB[1].num}-${axesB[0].num}`
    ];
    for(let key of pairs){
      if(wide[key]){
        bComb.push({
          combo: key,
          odds: wide[key],
          amount: bAmount,
          prob: (1 / wide[key]).toFixed(2)
        });
      }
    }
    bComb = bComb.slice(0,2); // 最大2点
  }

  // 表示
  let html = '<h3>A軸組み合わせ（3点 1500円）</h3><table><tr><th>組番</th><th>下限オッズ</th><th>金額</th><th>当たる確率</th></tr>';
  for(let c of aComb){
    html += `<tr><td>${c.combo}</td><td>${c.odds}</td><td>${c.amount}</td><td>${c.prob}</td></tr>`;
  }
  html += '</table>';

  html += '<h3>B軸組み合わせ（2点 1000円）</h3><table><tr><th>組番</th><th>下限オッズ</th><th>金額</th><th>当たる確率</th></tr>';
  for(let c of bComb){
    html += `<tr><td>${c.combo}</td><td>${c.odds}</td><td>${c.amount}</td><td>${c.prob}</td></tr>`;
  }
  html += '</table>';

  document.getElementById('result').innerHTML = html;
}
</script>
</body>
</html>